angular.module("ngPivot",[]).directive("ngPivot",function(){return{restrict:"AE",transclude:!0,scope:{model:"="},template:"<p>pivot</p>",link:function(a){var b=function(a,b){return function(){return a.apply(b,arguments)}},c=function(){function a(c,d){this.getAggregator=b(this.getAggregator,this),this.getRowKeys=b(this.getRowKeys,this),this.getColKeys=b(this.getColKeys,this),this.sortKeys=b(this.sortKeys,this),this.arrSort=b(this.arrSort,this),this.natSort=b(this.natSort,this),this.aggregator=d.aggregator,this.aggregatorName=d.aggregatorName,this.colAttrs=d.cols,this.rowAttrs=d.rows,this.valAttrs=d.vals,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.sorted=!1,a.forEachRecord(c,d.derivedAttributes,function(a){return function(b){return d.filter(b)?a.processRecord(b):void 0}}(this))}return a.forEachRecord=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;if(d=$.isEmptyObject(b)?c:function(a){var d,e,f;for(d in b)e=b[d],a[d]=null!=(f=e(a))?f:a[d];return c(a)},$.isFunction(a))return a(d);if($.isArray(a)){if($.isArray(a[0])){n=[];for(f in a)if(__hasProp.call(a,f)&&(e=a[f],f>0)){i={},m=a[0];for(g in m)__hasProp.call(m,g)&&(h=m[g],i[h]=e[g]);n.push(d(i))}return n}for(o=[],k=0,l=a.length;l>k;k++)i=a[k],o.push(d(i));return o}if(a instanceof jQuery)return j=[],$("thead > tr > th",a).each(function(){return j.push($(this).text())}),$("tbody > tr",a).each(function(){return i={},$("td",this).each(function(a){return i[j[a]]=$(this).text()}),d(i)});throw new Error("unknown input format")},a.convertToArray=function(b){var c;return c=[],a.forEachRecord(b,{},function(a){return c.push(a)}),c},a.prototype.natSort=function(a,b){return naturalSort(a,b)},a.prototype.arrSort=function(a,b){return this.natSort(a.join(),b.join())},a.prototype.sortKeys=function(){return this.sorted||(this.rowKeys.sort(this.arrSort),this.colKeys.sort(this.arrSort)),this.sorted=!0},a.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},a.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},a.prototype.processRecord=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=[],e=[],k=this.colAttrs,g=0,i=k.length;i>g;g++)f=k[g],b.push(null!=(l=a[f])?l:"null");for(m=this.rowAttrs,h=0,j=m.length;j>h;h++)f=m[h],e.push(null!=(n=a[f])?n:"null");return d=e.join(String.fromCharCode(0)),c=b.join(String.fromCharCode(0)),this.allTotal.push(a),0!==e.length&&(this.rowTotals[d]||(this.rowKeys.push(e),this.rowTotals[d]=this.aggregator(this,e,[])),this.rowTotals[d].push(a)),0!==b.length&&(this.colTotals[c]||(this.colKeys.push(b),this.colTotals[c]=this.aggregator(this,[],b)),this.colTotals[c].push(a)),0!==b.length&&0!==e.length?(this.tree[d]||(this.tree[d]={}),this.tree[d][c]||(this.tree[d][c]=this.aggregator(this,e,b)),this.tree[d][c].push(a)):void 0},a.prototype.getAggregator=function(a,b){var c,d,e;return e=a.join(String.fromCharCode(0)),d=b.join(String.fromCharCode(0)),c=0===a.length&&0===b.length?this.allTotal:0===a.length?this.colTotals[d]:0===b.length?this.rowTotals[e]:this.tree[e][d],null!=c?c:{value:function(){return null},format:function(){return""}}},a}(),d=new c(a.data,{aggregatorName:"count"});console.log(d)}}}),function(a){"use strict";window.angular&&window.Sortable?a(angular,Sortable):"function"==typeof define&&define.amd&&define(["angular","sortable"],a)}(function(a,b){"use strict";a.module("ngPivot").constant("$version","0.3.4").directive("ngSortable",["$parse",function(c){function d(b){var d=a.element(b).scope(),e=[].filter.call(b.childNodes,function(a){return 8===a.nodeType&&-1!==a.nodeValue.indexOf("ngRepeat:")})[0];e=e.nodeValue.match(/ngRepeat:\s*(?:\(.*?,\s*)?([^\s)]+)[\s)]+in\s+([^\s|]+)/);var f=c(e[1]),g=c(e[2]);return{item:function(b){return f(a.element(b).scope())},items:function(){return g(d)}}}var e,f;return{restrict:"AC",link:function(c,g,h){function i(a){var b=a.oldIndex,g=a.newIndex,h=n.items();if(k!==a.from){var i=d(a.from),j=i.items();b=j.indexOf(i.item(a.item)),e=j[b],a.clone?a.from.removeChild(a.clone):j.splice(b,1),h.splice(g,0,e),a.from.insertBefore(a.item,f)}else h.splice(g,0,h.splice(b,1)[0]);c.$apply()}var j,k=g[0],l=h.ngSortable,m=c.$eval(l)||{},n=d(k);"Start End Add Update Remove Sort".split(" ").forEach(function(a){m["on"+a]=m["on"+a]||function(){}}),j=b.create(k,Object.keys(m).reduce(function(a,b){return a[b]=a[b]||m[b],a},{onStart:function(a){f=a.item.nextSibling,m.onStart(n.items())},onEnd:function(){m.onEnd(n.items())},onAdd:function(a){i(a),m.onAdd(n.items(),e)},onUpdate:function(a){i(a),m.onUpdate(n.items(),n.item(a.item))},onRemove:function(){m.onRemove(n.items(),e)},onSort:function(){m.onSort(n.items())}})),g.on("$destroy",function(){j.destroy(),j=null,f=null}),l&&!/{|}/.test(l)&&a.forEach(["sort","disabled","draggable","handle","animation"],function(a){c.$watch(l+"."+a,function(b){void 0!==b&&(m[a]=b,j.option(a,b))})})}}}])});